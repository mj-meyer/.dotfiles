# â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—
# â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•
#    â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ•”â•
#    â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—
#    â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•—
#    â•šâ•â•   â•šâ•â•     â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•
# Terminal multiplexer
# https://github.com/tmux/tmux


# ==============================================================================
# Terminal & Display
# ==============================================================================

set -g default-terminal "screen-256color"
set-option -sa terminal-features ',xterm-256color:RGB'
set-option -sa terminal-overrides ",xterm*:Tc"
set-option -g history-limit 10000
set-option -g focus-events on


# ==============================================================================
# General Settings
# ==============================================================================

set -g prefix C-b
unbind C-a
bind-key C-b send-prefix

set -g base-index 1              # start window numbering at 1
set -g mouse on                  # enable mouse support
set -g detach-on-destroy off     # don't exit tmux when closing a session


# ==============================================================================
# Key Bindings
# ==============================================================================

# Reload config
unbind r
bind r source-file ~/.tmux.conf \; display-message "Config reloaded"

# Window splits (\ for horizontal, - for vertical)
unbind |
bind \\ split-window -h
unbind '"'
bind - split-window -v

# Pane resizing (hjkl with repeat)
bind -r h resize-pane -L 5
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5

# Maximize/minimize pane
bind -r m resize-pane -Z

# Skip kill-pane confirmation prompt
bind-key x kill-pane

# Set pane title interactively
bind-key L command-prompt -p "Pane title:" "select-pane -T '%%'"


# ==============================================================================
# Copy Mode (vim-style)
# ==============================================================================

set-window-option -g mode-keys vi
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send -X copy-selection
unbind -T copy-mode-vi MouseDragEnd1Pane  # don't exit copy mode after dragging


# ==============================================================================
# Plugins
# ==============================================================================

# Plugin manager
set -g @plugin 'tmux-plugins/tpm'

# Navigation (ctrl-hjkl to move between tmux panes and vim splits)
set -g @plugin 'christoomey/vim-tmux-navigator'

# Theme
set -g @plugin "janoamaral/tokyo-night-tmux"
set -g @tokyo-night-tmux_window_id_style digital
set -g @tokyo-night-tmux_pane_id_style hsquare
set -g @tokyo-night-tmux_zoom_id_style dsquare
set -g @tokyo-night-tmux_show_music 1
set -g @tokyo-night-tmux_show_datetime 0
set -g @tokyo-night-tmux_time_format 12H


# ==============================================================================
# Sesh - Session Manager
# https://github.com/joshmedeski/sesh
# ==============================================================================

# prefix + T: open sesh session picker
bind-key "T" run-shell "sesh connect \"$(
  sesh list --icons | fzf-tmux -p 80%,70% \
    --no-sort --ansi --border-label ' sesh ' --prompt 'âš¡  ' \
    --header '  ^a all ^t tmux ^g configs ^x zoxide ^w worktrees ^d kill ^f find' \
    --bind 'tab:down,btab:up' \
    --bind 'ctrl-a:change-prompt(âš¡  )+reload(sesh list --icons)' \
    --bind 'ctrl-t:change-prompt(ğŸªŸ  )+reload(sesh list -t --icons)' \
    --bind 'ctrl-g:change-prompt(âš™ï¸  )+reload(sesh list -c --icons)' \
    --bind 'ctrl-x:change-prompt(ğŸ“  )+reload(sesh list -z --icons)' \
    --bind 'ctrl-w:change-prompt(ğŸŒ³  )+reload(sesh list --icons -z | grep -F \"$(sesh root)\")' \
    --bind 'ctrl-f:change-prompt(ğŸ”  )+reload(fd -H -d 2 -t d -E .Trash . ~)' \
    --bind 'ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(âš¡  )+reload(sesh list --icons)' \
    --preview-window 'right:55%' \
    --preview 'sesh preview {}'
)\""

# ctrl+]: open sesh session picker (mapped from cmd+k in wezterm)
bind-key -n C-] run-shell "sesh connect \"$(
  sesh list --icons | fzf-tmux -p 80%,70% \
    --no-sort --ansi --border-label ' sesh ' --prompt 'âš¡  ' \
    --header '  ^a all ^t tmux ^g configs ^x zoxide ^w worktrees ^d kill ^f find' \
    --bind 'tab:down,btab:up' \
    --bind 'ctrl-a:change-prompt(âš¡  )+reload(sesh list --icons)' \
    --bind 'ctrl-t:change-prompt(ğŸªŸ  )+reload(sesh list -t --icons)' \
    --bind 'ctrl-g:change-prompt(âš™ï¸  )+reload(sesh list -c --icons)' \
    --bind 'ctrl-x:change-prompt(ğŸ“  )+reload(sesh list -z --icons)' \
    --bind 'ctrl-w:change-prompt(ğŸŒ³  )+reload(sesh list --icons -z | grep -F \"$(sesh root)\")' \
    --bind 'ctrl-f:change-prompt(ğŸ”  )+reload(fd -H -d 2 -t d -E .Trash . ~)' \
    --bind 'ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(âš¡  )+reload(sesh list --icons)' \
    --preview-window 'right:55%' \
    --preview 'sesh preview {}'
)\""


# ==============================================================================
# Initialize TPM (must be at the very bottom)
# ==============================================================================

run '~/.tmux/plugins/tpm/tpm'

# Pane border labels (after TPM to override tokyo-night-tmux theme)
set -g pane-border-status top
set -g pane-border-format " #{pane_title} "
